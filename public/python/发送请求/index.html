<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>发送请求 - 我的全新 Hugo 网站</title><meta name="Description" content="使用urllib的request模块，可以方便的实现请求的发送并得到响应。"><meta property="og:title" content="发送请求" />
<meta property="og:description" content="使用urllib的request模块，可以方便的实现请求的发送并得到响应。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/python/%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82/" />
<meta property="article:published_time" content="2020-04-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-04-24T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="发送请求"/>
<meta name="twitter:description" content="使用urllib的request模块，可以方便的实现请求的发送并得到响应。"/>
<meta name="application-name" content="我的全新 Hugo 网站">
<meta name="apple-mobile-web-app-title" content="我的全新 Hugo 网站"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/python/%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82/" /><link rel="prev" href="http://example.org/python/%E5%8F%98%E9%87%8F%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" /><link rel="next" href="http://example.org/python/%E5%87%BD%E6%95%B0/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "发送请求",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/python\/%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82\/"
        },"genre": "Python","keywords": "urlopen(), urllib, 爬虫","wordcount":  806 ,
        "url": "http:\/\/example.org\/python\/%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82\/","datePublished": "2020-04-24T00:00:00+00:00","dateModified": "2020-04-24T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "作者"},"author": {
                "@type": "Person",
                "name": "作者"
            },"description": "使用urllib的request模块，可以方便的实现请求的发送并得到响应。"
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="我的全新 Hugo 网站">我的全新 Hugo 网站</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="我的全新 Hugo 网站">我的全新 Hugo 网站</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="page single special"><h1 class="single-title animated pulse faster">发送请求</h1><div class="content" id="content"><p>使用urllib的request模块，可以方便的实现请求的发送并得到响应。</p>
<h2 id="发送请求">发送请求</h2>
<h3 id="urlopen">urlopen()</h3>
<p>抓取Python官网：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">&#34;https://www.python.org&#34;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</code></pre></div><p><em>部分</em>输出：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 部分输出</span>

    <span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&#34;//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js&#34;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="n">window</span><span class="o">.</span><span class="n">jQuery</span> <span class="o">||</span> <span class="n">document</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;script src=&#34;/static/js/libs/jquery-1.8.2.min.js&#34;&gt;&lt;\/script&gt;&#39;</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&#34;/static/js/libs/masonry.pkgd.min.js&#34;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&#34;text/javascript&#34;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&#34;/static/js/main-min.js&#34;</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</code></pre></div><blockquote>
<p><code>decode('utf-8')</code>方法将网页以制定编码解析。</p>
</blockquote>
<p><code>response</code>是一个<code>HTTPResponse</code>类型的对象：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
</code></pre></div><p>输出如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPResponse</span><span class="s1">&#39;&gt;</span>
</code></pre></div><p>它包含<code>read()</code>、<code>readinto()</code>、<code>getheader(name)</code>、<code>getheaders()</code>、<code>fileno()</code>等方法，以及<code>msg</code>、<code>version</code>、<code>status</code>、<code>reason</code>、<code>debuglevel</code>、<code>closed</code>等属性。</p>
<p>例子：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">&#34;https://www.baidu.com&#34;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">response</span><span class="o">.</span><span class="n">getheaders</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">response</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">))</span>
</code></pre></div><p>输出结果：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="mi">200</span>

 <span class="p">[(</span><span class="s1">&#39;Accept-Ranges&#39;</span><span class="p">,</span> <span class="s1">&#39;bytes&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Cache-Control&#39;</span><span class="p">,</span> <span class="s1">&#39;no-cache&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">,</span> <span class="s1">&#39;227&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Thu, 09 Aug 2018 14:49:17 GMT&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Etag&#39;</span><span class="p">,</span> <span class="s1">&#39;&#34;5b56b4a8-e3&#34;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Last-Modified&#39;</span><span class="p">,</span> <span class="s1">&#39;Tue, 24 Jul 2018 05:10:00 GMT&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;P3p&#39;</span><span class="p">,</span> <span class="s1">&#39;CP=&#34; OTI DSP COR IVA OUR IND COM &#34;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Pragma&#39;</span><span class="p">,</span> <span class="s1">&#39;no-cache&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">,</span> <span class="s1">&#39;BWS/1.1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;BD_NOT_HTTPS=1; path=/; Max-Age=300&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span><span class="s1">&#39;BIDUPSID=9FA4E613328025CC47152BC4A49E9AB3; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;PSTM=1533826157; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="p">,</span> <span class="s1">&#39;max-age=0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;X-Ua-Compatible&#39;</span><span class="p">,</span> <span class="s1">&#39;IE=Edge,chrome=1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Connection&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">)]</span>

 <span class="n">BWS</span><span class="o">/</span><span class="mf">1.1</span>
</code></pre></div><p>可见，分别输出了<code>状态码</code>、<code>响应头</code>和响应头里面的<code>Server</code>值。</p>
<h4 id="urlopen的参数">urlopen()的参数</h4>
<p><code>urlopen()</code>可以给链接传递一些参数，它的<code>API</code>如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,[</span><span class="n">timeout</span><span class="p">,]</span><span class="o">*</span><span class="p">,</span><span class="n">cafile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">cadefault</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">comtext</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</code></pre></div><h5 id="data参数">data参数</h5>
<p>如果添加该参数，且它是<code>bytes（字节流）</code>类型，则需要通过<code>bytes()</code>方法转化，传递了该参数，它的请求方式就不再是<code>GET</code>，而是<code>POST</code>方式。</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">({</span><span class="s1">&#39;word&#39;</span><span class="p">:</span><span class="s1">&#39;hello&#39;</span><span class="p">}),</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">&#34;http://httpbin.org/post&#34;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div><p>转换为<code>bytes（字节流）</code>类型的方法<code>types()</code>需要两个参数：
第一个是<code>str（字符串）</code>类型的参数，第二个是指定编码格式。</p>
<p>需要使用<code>urllib.parse</code>模块的<code>urlencode()</code>方法，将字典转化为字符串。</p>
<h5 id="timeout参数">timeout参数</h5>
<p>timeout参数用于设置超时时间，单位为<code>秒</code>，如果请求超过了设置的时间，就会抛出异常。它支持<code>HTTP</code>、<code>HTTPS</code>、<code>FTP</code>请求。</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">&#34;http://joecy.wang&#34;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</code></pre></div><p>输出：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 部分代码</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&#34;/home/joecy/Desktop/TestCode/Untitled-3.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
   <span class="o">......</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">urlopen</span> <span class="n">error</span> <span class="n">timed</span> <span class="n">out</span><span class="o">&gt;</span>
</code></pre></div><p>使用try-except处理异常：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">&#34;http://joecy.wang&#34;</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">timeout</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;超时&#34;</span><span class="p">)</span>

</code></pre></div><blockquote>
<p>使用ininstance判断异常e.reason是不是socket.timeout类型。</p>
</blockquote>
<p>输出：</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="err">超时</span>
</code></pre></div></div></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
