<!DOCTYPE html>
<html lang="zh">
  <head>
    
      <title>发送请求 :: XiaoXi Blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="使用urllib的request模块，可以方便的实现请求的发送并得到响应。
发送请求 urlopen() 抓取Python官网：
import urllib.request response = urllib.request.urlopen(&amp;#34;https://www.python.org&amp;#34;) print(response.read().decode(&amp;#39;utf-8&amp;#39;)) 部分输出：
# 部分输出 &amp;lt;script src=&amp;#34;//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js&amp;#34;&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;script&amp;gt;window.jQuery || document.write(&amp;#39;&amp;lt;script src=&amp;#34;/static/js/libs/jquery-1.8.2.min.js&amp;#34;&amp;gt;&amp;lt;\/script&amp;gt;&amp;#39;)&amp;lt;/script&amp;gt; &amp;lt;script src=&amp;#34;/static/js/libs/masonry.pkgd.min.js&amp;#34;&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;script type=&amp;#34;text/javascript&amp;#34; src=&amp;#34;/static/js/main-min.js&amp;#34; charset=&amp;#34;utf-8&amp;#34;&amp;gt;&amp;lt;/script&amp;gt;  decode(&#39;utf-8&#39;)方法将网页以制定编码解析。
 response是一个HTTPResponse类型的对象：
print(type(response)) 输出如下：
&amp;lt;class &amp;#39;http.client.HTTPResponse&amp;#39;&amp;gt; 它包含read()、readinto()、getheader(name)、getheaders()、fileno()等方法，以及msg、version、status、reason、debuglevel、closed等属性。
例子：
import urllib.request response = urllib.request.urlopen(&amp;#34;https://www.baidu.com&amp;#34;) print(response.status) print(&amp;#39;\n&amp;#39;,response.getheaders()) print(&amp;#39;\n&amp;#39;,response.getheader(&amp;#39;Server&amp;#39;)) 输出结果：
200 [(&amp;#39;Accept-Ranges&amp;#39;, &amp;#39;bytes&amp;#39;), (&amp;#39;Cache-Control&amp;#39;, &amp;#39;no-cache&amp;#39;), (&amp;#39;Content-Length&amp;#39;, &amp;#39;227&amp;#39;), (&amp;#39;Content-Type&amp;#39;, &amp;#39;text/html&amp;#39;), (&amp;#39;Date&amp;#39;, &amp;#39;Thu, 09 Aug 2018 14:49:17 GMT&amp;#39;), (&amp;#39;Etag&amp;#39;, &amp;#39;&amp;#34;5b56b4a8-e3&amp;#34;&amp;#39;), (&amp;#39;Last-Modified&amp;#39;, &amp;#39;Tue, 24 Jul 2018 05:10:00 GMT&amp;#39;), (&amp;#39;P3p&amp;#39;, &amp;#39;CP=&amp;#34; OTI DSP COR IVA OUR IND COM &amp;#34;&amp;#39;), (&amp;#39;Pragma&amp;#39;, &amp;#39;no-cache&amp;#39;), (&amp;#39;Server&amp;#39;, &amp;#39;BWS/1."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="发送请求"/>
<meta name="twitter:description" content="使用urllib的request模块，可以方便的实现请求的发送并得到响应。"/>



<meta property="og:title" content="发送请求" />
<meta property="og:description" content="使用urllib的request模块，可以方便的实现请求的发送并得到响应。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82/" />
<meta property="article:published_time" content="2020-04-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-04-24T00:00:00+00:00" /><meta property="og:site_name" content="XiaoXi Blog" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">XiaoXi</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/showcase">Showcase</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="/posts/%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82/">发送请求</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-04-24
        </span>

        
          
        
      

      
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/urlopen/">urlopen()</a>&nbsp;
        
          #<a href="/tags/urllib/">urllib</a>&nbsp;
        
          #<a href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <p>使用urllib的request模块，可以方便的实现请求的发送并得到响应。</p>
<h2 id="发送请求">发送请求</h2>
<h3 id="urlopen">urlopen()</h3>
<p>抓取Python官网：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> urllib.request

response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(<span style="color:#e6db74">&#34;https://www.python.org&#34;</span>)
<span style="color:#66d9ef">print</span>(response<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>))
</code></pre></div><p><em>部分</em>输出：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 部分输出</span>

    <span style="color:#f92672">&lt;</span>script src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js&#34;</span><span style="color:#f92672">&gt;&lt;/</span>script<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>script<span style="color:#f92672">&gt;</span>window<span style="color:#f92672">.</span>jQuery <span style="color:#f92672">||</span> document<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;&lt;script src=&#34;/static/js/libs/jquery-1.8.2.min.js&#34;&gt;&lt;\/script&gt;&#39;</span>)<span style="color:#f92672">&lt;/</span>script<span style="color:#f92672">&gt;</span>

    <span style="color:#f92672">&lt;</span>script src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/js/libs/masonry.pkgd.min.js&#34;</span><span style="color:#f92672">&gt;&lt;/</span>script<span style="color:#f92672">&gt;</span>

    <span style="color:#f92672">&lt;</span>script type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span> src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/js/main-min.js&#34;</span> charset<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">&gt;&lt;/</span>script<span style="color:#f92672">&gt;</span>
</code></pre></div><blockquote>
<p><code>decode('utf-8')</code>方法将网页以制定编码解析。</p>
</blockquote>
<p><code>response</code>是一个<code>HTTPResponse</code>类型的对象：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(type(response))
</code></pre></div><p>输出如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">http</span><span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>HTTPResponse<span style="color:#e6db74">&#39;&gt;</span>
</code></pre></div><p>它包含<code>read()</code>、<code>readinto()</code>、<code>getheader(name)</code>、<code>getheaders()</code>、<code>fileno()</code>等方法，以及<code>msg</code>、<code>version</code>、<code>status</code>、<code>reason</code>、<code>debuglevel</code>、<code>closed</code>等属性。</p>
<p>例子：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> urllib.request

response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(<span style="color:#e6db74">&#34;https://www.baidu.com&#34;</span>)
<span style="color:#66d9ef">print</span>(response<span style="color:#f92672">.</span>status)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>,response<span style="color:#f92672">.</span>getheaders())
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>,response<span style="color:#f92672">.</span>getheader(<span style="color:#e6db74">&#39;Server&#39;</span>))
</code></pre></div><p>输出结果：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ae81ff">200</span>

 [(<span style="color:#e6db74">&#39;Accept-Ranges&#39;</span>, <span style="color:#e6db74">&#39;bytes&#39;</span>), (<span style="color:#e6db74">&#39;Cache-Control&#39;</span>, <span style="color:#e6db74">&#39;no-cache&#39;</span>), (<span style="color:#e6db74">&#39;Content-Length&#39;</span>, <span style="color:#e6db74">&#39;227&#39;</span>), (<span style="color:#e6db74">&#39;Content-Type&#39;</span>, <span style="color:#e6db74">&#39;text/html&#39;</span>), (<span style="color:#e6db74">&#39;Date&#39;</span>, <span style="color:#e6db74">&#39;Thu, 09 Aug 2018 14:49:17 GMT&#39;</span>), (<span style="color:#e6db74">&#39;Etag&#39;</span>, <span style="color:#e6db74">&#39;&#34;5b56b4a8-e3&#34;&#39;</span>), (<span style="color:#e6db74">&#39;Last-Modified&#39;</span>, <span style="color:#e6db74">&#39;Tue, 24 Jul 2018 05:10:00 GMT&#39;</span>), (<span style="color:#e6db74">&#39;P3p&#39;</span>, <span style="color:#e6db74">&#39;CP=&#34; OTI DSP COR IVA OUR IND COM &#34;&#39;</span>), (<span style="color:#e6db74">&#39;Pragma&#39;</span>, <span style="color:#e6db74">&#39;no-cache&#39;</span>), (<span style="color:#e6db74">&#39;Server&#39;</span>, <span style="color:#e6db74">&#39;BWS/1.1&#39;</span>), (<span style="color:#e6db74">&#39;Set-Cookie&#39;</span>, <span style="color:#e6db74">&#39;BD_NOT_HTTPS=1; path=/; Max-Age=300&#39;</span>), (<span style="color:#e6db74">&#39;Set-Cookie&#39;</span>,<span style="color:#e6db74">&#39;BIDUPSID=9FA4E613328025CC47152BC4A49E9AB3; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com&#39;</span>), (<span style="color:#e6db74">&#39;Set-Cookie&#39;</span>, <span style="color:#e6db74">&#39;PSTM=1533826157; expires=Thu, 31-Dec-37 23:55:55 GMT; max-age=2147483647; path=/; domain=.baidu.com&#39;</span>), (<span style="color:#e6db74">&#39;Strict-Transport-Security&#39;</span>, <span style="color:#e6db74">&#39;max-age=0&#39;</span>), (<span style="color:#e6db74">&#39;X-Ua-Compatible&#39;</span>, <span style="color:#e6db74">&#39;IE=Edge,chrome=1&#39;</span>), (<span style="color:#e6db74">&#39;Connection&#39;</span>, <span style="color:#e6db74">&#39;close&#39;</span>)]

 BWS<span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</code></pre></div><p>可见，分别输出了<code>状态码</code>、<code>响应头</code>和响应头里面的<code>Server</code>值。</p>
<h4 id="urlopen的参数">urlopen()的参数</h4>
<p><code>urlopen()</code>可以给链接传递一些参数，它的<code>API</code>如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(url,data<span style="color:#f92672">=</span>None,[timeout,]<span style="color:#f92672">*</span>,cafile<span style="color:#f92672">=</span>None,cadefault<span style="color:#f92672">=</span>False,comtext<span style="color:#f92672">=</span>None)
</code></pre></div><h5 id="data参数">data参数</h5>
<p>如果添加该参数，且它是<code>bytes（字节流）</code>类型，则需要通过<code>bytes()</code>方法转化，传递了该参数，它的请求方式就不再是<code>GET</code>，而是<code>POST</code>方式。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> urllib.parse
<span style="color:#f92672">import</span> urllib.request

data <span style="color:#f92672">=</span> bytes(urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>urlencode({<span style="color:#e6db74">&#39;word&#39;</span>:<span style="color:#e6db74">&#39;hello&#39;</span>}),encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>)
response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(<span style="color:#e6db74">&#34;http://httpbin.org/post&#34;</span>,data<span style="color:#f92672">=</span>data)
<span style="color:#66d9ef">print</span>(response<span style="color:#f92672">.</span>read())
</code></pre></div><p>转换为<code>bytes（字节流）</code>类型的方法<code>types()</code>需要两个参数：
第一个是<code>str（字符串）</code>类型的参数，第二个是指定编码格式。</p>
<p>需要使用<code>urllib.parse</code>模块的<code>urlencode()</code>方法，将字典转化为字符串。</p>
<h5 id="timeout参数">timeout参数</h5>
<p>timeout参数用于设置超时时间，单位为<code>秒</code>，如果请求超过了设置的时间，就会抛出异常。它支持<code>HTTP</code>、<code>HTTPS</code>、<code>FTP</code>请求。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> urllib.request

response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(<span style="color:#e6db74">&#34;http://joecy.wang&#34;</span>,timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>)
<span style="color:#66d9ef">print</span>(response<span style="color:#f92672">.</span>read())
</code></pre></div><p>输出：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 部分代码</span>
Traceback (most recent call last):
  File <span style="color:#e6db74">&#34;/home/joecy/Desktop/TestCode/Untitled-3.py&#34;</span>, line <span style="color:#ae81ff">3</span>, <span style="color:#f92672">in</span> <span style="color:#f92672">&lt;</span>module<span style="color:#f92672">&gt;</span>
   <span style="color:#f92672">......</span>
urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>URLError: <span style="color:#f92672">&lt;</span>urlopen error timed out<span style="color:#f92672">&gt;</span>
</code></pre></div><p>使用try-except处理异常：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> socket
<span style="color:#f92672">import</span> urllib.request

<span style="color:#66d9ef">try</span>:
    response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(<span style="color:#e6db74">&#34;http://joecy.wang&#34;</span>,timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">0.001</span>)
<span style="color:#66d9ef">except</span> urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>URLError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">if</span> isinstance(e<span style="color:#f92672">.</span>reason,socket<span style="color:#f92672">.</span>timeout):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;超时&#34;</span>)

</code></pre></div><blockquote>
<p>使用ininstance判断异常e.reason是不是socket.timeout类型。</p>
</blockquote>
<p>输出：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">超时</span>
</code></pre></div>
    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/posts/%E5%87%BD%E6%95%B0/">
                  <span class="button__icon">←</span>
                  <span class="button__text">函数</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/posts/%E5%8F%98%E9%87%8F%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">
                  <span class="button__text">变量与数据类型</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">XiaoXi</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2020 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
